
defaultNamespace: mlops-system

dependsOn: []

helm:
  repos:
  - name: bitnami
    url: https://charts.bitnami.com/bitnami
  - name: argo
    url: https://argoproj.github.io/argo-helm
  - name: prometheus-community
    url: https://prometheus-community.github.io/helm-charts
  - name: grafana
    url: https://grafana.github.io/helm-charts

  releases:
    - name: namespaces
      chart: "oci://ghcr.io/rancher/fleet-crd-placeholder"   # trick: no-op; we apply k8s/namespaces.yaml via manifests
      version: "0.0.0"
      install:
        crds: Create
      values: {}

    - name: minio
      chart: bitnami/minio
      valuesFiles:
        - ../../helm-values/minio.yaml

    - name: pg-postgresql
      chart: bitnami/postgresql
      valuesFiles:
        - ../../helm-values/postgresql.yaml

    - name: monitoring
      chart: prometheus-community/kube-prometheus-stack
      valuesFiles:
        - ../../helm-values/kube-prometheus-stack.yaml

    - name: loki
      chart: grafana/loki-stack
      valuesFiles:
        - ../../helm-values/loki-stack.yaml

    - name: argo
      chart: argo/argo-workflows
      valuesFiles:
        - ../../helm-values/argo-workflows.yaml

    - name: mlflow
      chart: ../../charts/mlflow
      valuesFiles:
        - ../../helm-values/mlflow.yaml

targetCustomizations:
  - name: apply-namespaces-and-secrets
    yaml:
      overlays:
        - resources
    clusterSelector:
      matchExpressions: []
    kustomize:
      dir: ./
    helm:
      releaseName: bootstrap-k8s
    # apply raw manifests
    # Fleet autom√°ticamente procesa archivos en la carpeta bundle junto a fleet.yaml
manifests:
  kustomize:
    dir: ../../k8s
